<?xml version="1.0" encoding="US-ASCII"?>

<!-- ============= Automating Simulation Sessions with ESS ========== -->
<chapter id="writing-ecs"> 
  <title>Automating Simulation Sessions with &ecell Session Script</title> 

  <highlights>
    <para>By reading this chapter, you can get information about the
    following items:
      <simplelist>
	<member>What is &ecell Session Script (<acronym>ESS</acronym>).</member>

	<member>How to automate the simulation by writing the
          <acronym>ESS</acronym> files.</member>

	<member>How to run &ecell in scripting mode.</member>

        <member>How to customize existing frontend software components.</member>

      </simplelist>
</para>
  </highlights>

  <sect1>
    <title>What is &ecell Session Script?</title>

    <para>need description here.</para>

  </sect1>


  


  <sect1>
    <title>Running &ecell Session Script</title>

    <para>There are roughly three ways to execute <acronym>ESS</acronym>;

      <itemizedlist>
	<listitem>
	  <para>Execute the script from operating system's command
	  line (shell prompt).
          </para>
	</listitem>
	<listitem>
	  <para>Load the script from a frontend software such as Osogo
	  Session Monitor.</para>
	</listitem>
	<listitem>
	  <para>Use SessionManager to automate the invokation of the
	  simulation sessions, as well as the generation of the
	  <acronym>ESS</acronym> itself, for simulations involving
	  multiple runs of the simulator.</para>
	</listitem>

      </itemizedlist>
    </para>

    <sect2>
      <title>Running the <acronym>ESS</acronym> in command line mode</title>

      <para>To run a <acronym>ESS</acronym> in command line, use
      <command>ecell3-session</command> command.
      </para>

      <cmdsynopsis>
	<command>ecell3-session</command>
	<arg><replaceable>file.ess</replaceable></arg>
      </cmdsynopsis>

      
      <sect3>
	<title>In batch mode</title>
	

	<para>
	To execute a <acronym>ESS</acronym> file, type the following
	command at the shell prompt:

        <screen>
          <prompt>$</prompt> <userinput><command>ecell3-session</command> <replaceable>filename.ess</replaceable>
          </userinput>
        </screen>

        <command>ecell3-session</command> command loads the
        <acronym>ESS</acronym> file and runs a single simulation
        session as described in the file.
      </para>

      </sect3>

      <sect3>
	<title>In interactive mode</title>

	<para>To run the <command>ecell3-session</command> in
	interactive mode, invoke the command without the filename
	argument.

        <screen><prompt>$</prompt> <userinput><command>ecell3-session</command></userinput>
ecell3-session [ for E-Cell SE Version 3, on Python Version 2.2.1 ]
Copyright (C) 1996-2002 Keio University.
Written by Kouichi Takahashi <email>shafi@e-cell.org</email>
<prompt>ecell3-session>>> </prompt>
        </screen>
        
        The banner and the prompt shown here may vary according to the
        version you are using.
</para>
      </sect3>

      <sect3>
	<title>Giving parameters to the script</title>
	<para>not implemented yet</para>
      </sect3>


    </sect2>

    <sect2>
      <title>Loading <acronym>ESS</acronym> from Osogo Session Monitor</title>

      <para>need explanation here, or just say see osogo's manual?</para>

    </sect2>


    <sect2>
      <title>Using SessionManager</title>

      <para>need description here.</para>

    </sect2>

  </sect1>

  <sect1>
    <title>Writing &ecell Session Script</title>

    <para>The syntax of <acronym>ESS</acronym> is a full set of
    <productname>Python</productname> script with some convenient
    features.</para>

    <para>Three major groups of object classes which are commonly used
    in ESS are <classname>Session</classname>,
    <classname>ObjectStub</classname> classes, and
    <classname>Datafile</classname> classes.</para>

    <para>This section explains how to use these classes in your ESS.</para>

    <sect2>
      <title>Using Session methods</title>


      <sect3>
	<title>General rules</title>

      <para>In <acronym>ESS</acronym>, usualy an instance of
    <classname>Session</classname> is given, and any methods defined
    in the class can be used as if it is defined in global namespace.
    </para>

      <para>For example, to run the simulation for 10 seconds, you may use
    <methodname>run</methodname> method of a
    <classname>Session</classname> object in your
    <acronym>ESS</acronym> file.

    <informalexample> 
	  <programlisting>self.run( 10 )</programlisting>
	</informalexample> 

    where <methodname>self.</methodname> is the current
    <classname>Session</classname> object given by the
    system. Alternatively you can use <varname>theSession</varname> as
    the <varname>self</varname>.

    <informalexample> 
	  <programlisting>theSession.run( 10 )</programlisting>
	</informalexample> 
    </para>

    <para>Unlike usual <productname>Python</productname> script, you
    can omit the object on which the method is called if the object is
    the current <classname>Session</classname>.
    <informalexample>
	<programlisting>run( 10 )</programlisting>
    </informalexample>
    </para>

      </sect3>


      <sect3>
	<title>Loading a model</title>

      <para>Let's try this in the interactive mode of the
      <command>ecell3-session</command> command.  On the prompt of the
      command, you may load a model by using
      <methodname>loadModel</methodname>() method.

      <informalexample>
	  <screen><prompt>ecell3-session>>> </prompt><userinput>loadModel( 'simple.eml' )</userinput></screen>
	</informalexample>
    
    Then the prompt changes from <prompt>ecell3-session>>> </prompt> to <prompt><replaceable>model name</replaceable>, t=<replaceable>current time</replaceable>>>> </prompt>

    <informalexample><screen><prompt>simple.eml, t=0>>> </prompt></screen>
	</informalexample>
    </para>
      </sect3>

      <sect3>
	<title>Running the simulation</title>

	<para>To proceed the time by executing the simulation,
	<methodname>step</methodname>() and
	<methodname>run</methodname>() methods are used.</para>

	<informalexample><screen><prompt>simple.eml, t=0>>> </prompt><userinput>step()</userinput>
<prompt>simple.eml, t=0>>> </prompt><userinput>step()</userinput>
<prompt>simple.eml, t=7.67306e-07>>> </prompt><userinput>run( 10 )</userinput>
<prompt>simple.eml, t=10.0032>>> </prompt>
</screen>
	</informalexample>

	<para>
          <methodname>step</methodname>( <parameter>n</parameter> )
 conducts <parameter>n</parameter> steps of the simulation. The
 default value of <parameter>n</parameter> is 1.</para>

	<note>
	  <para>In tne above example you may notice that the first
	  call of <methodname>step</methodname>() doesn't cause the
	  time to change.  The simulator updates the time at the
	  beginning of the step, and calculates a tentative step size
	  after that.  The initial value of the step size is zero.
	  Thus it needs to call <methodname>step</methodname>() twice
	  to actually proceed the time.  See chapter 6 for details of
	  the simulation mechanism.</para>
	</note>

	<para>To execute the simulation for some seconds, call
	<methodname>run</methodname> method with a duration in
	seconds. (e.g. <methodname>run</methodname>(
	<constant>10</constant> ) for 10 seconds.)</para>

	<note>
	  <para>The system supports <methodname>run</methodname>
	  without an argument to run forever, but only if both
	  <emphasis>event checker</emphasis> and <emphasis>event
	  handler</emphasis> are set.  If not, it raises an exception.
	  See <methodname>setEventChecker</methodname>() in the method
	  list of Session class below.

	  </para>
	</note>

      </sect3>
	
      <sect3>
	<title>Getting current time</title>

	<para>To get the current time of the simulator,
	<methodname>getCurrentTime</methodname>() method can be used.</para>

	<informalexample><screen>
<prompt>simple.eml, t=10.0032>>> </prompt><userinput>getCurrentTime()</userinput>
<computeroutput>10.003221620379463</computeroutput>
</screen>
	</informalexample>

      </sect3>
      
      <sect3>
	<title>Printing messages</title>

	<para>You may want to print some messages in your ESS.
        Use <methodname>message</methodname>( <parameter>message</parameter> )
	method, where <parameter>parameter</parameter> argument is a
	string to be outputed.</para>

	<para>By default the message is handled in a way the same as
         the Python's <methodname>print</methodname> statement; it is
         printed out to the standard out with a trailing new line.
         This behavior can be changed by using
         <methodname>setMessageMethod</methodname>() method.</para>

      </sect3>


      <sect3>
	<title>Example</title>

	<para>Here is a tiny example of using
	<classname>Session</classname> methods which loads a model,
	run a hundred seconds, and print a short message.

<example>
	    <title>A simple <acronym>ESS</acronym> example.</title>
	    
	    <programlisting linenumbering="numbered">loadModel( 'simple.eml' )
run( 100 )
message( 'stopped at %f seconds.' % getCurrentTime() )
</programlisting>
	  </example>
        </para>
	
      </sect3>



    </sect2>

    <sect2>
      <title>Getting Session parameters.</title>

      <para>Session parameters are given to ESS as global variables.
      To check what parameters are given to ESS, use
      <methodname>dir</methodname>() built-in function.  Session
      parameters are listed as well as other available methods and
      variables.</para>

      <note>
	<para>Currently there is no way to list only the Session
      parameters because these are given just as global
      variables.</para>
      </note>

      <para></para>

    </sect2>


    <sect2>
      <title>Observing and manipulating the model with <classname>ObjectStub</classname>s</title>

      <sect3>
	<title>What is <classname>ObjectStub</classname>?</title>

	<para><classname>ObjectStub</classname> is a...</para>

	<para>Explanation of backend/frontend isolation may come here.</para>

	<para>ObjectStub, EntityStub, StepperStub, LoggerStub</para>

      </sect3>


      <sect3>
	<title>Example</title>

	<para>The following example loads an EML file, and prints the
	value of ATP <classname>Variable</classname> in
	<classname>System</classname> <constant>/CELL</constant> every
	10 seconds.  If the value is below 1000, it stops the simulation.
</para>
	<example>
	  <title>An <acronym>ESS</acronym> to check ATP level every 10 seconds</title>
	  
	  <programlisting linenumbering="numbered">loadModel( 'simple.eml' )

ATP = createEntityStub( 'Variable:/CELL:ATP' )

while 1:

    ATPValue = ATP[ 'Value' ]

    message( 'ATP value = %s' % ATPValue )

    if ATPValue <= 1000:
        break

    run( 10 )

message( 'Stopped at %s.' % getCurrentTime() )
</programlisting>
	</example>

      </sect3>

    </sect2>

    <sect2>
      <title>Saving and handling data files</title>

      <para></para>

      <sect3>
	<title>Saving <classname>Logger</classname> data</title>

	<para>Howtos about <classname>ECDDataFile</classname> should
	come here.</para>
      </sect3>
    </sect2>


  </sect1>


  <sect1>
    <title>List of commonly used methods in ESS</title>

    <para>This section provides full lists of methods implemented in
      classes in &ecell Python library which are commonly used in ESS.
      </para>


    <sect2>
      <title><classname>Session</classname> class</title>

      <para>Methods of <classname>Session</classname> class can be
      devided into the following five groups.</para>

      <itemizedlist>
	<listitem>
	  <para>Session methods</para>
	</listitem>
	<listitem>
	  <para>Simulation methods</para>
	</listitem>
	<listitem>
	  <para>Stepper methods</para>
	</listitem>
	<listitem>
	  <para>Entity methods</para>
	</listitem>
	<listitem>
	  <para>Logger methods</para>
	</listitem>
      </itemizedlist>


      &session-class-api


    </sect2>



  </sect1>

  


</chapter>

<!--
Local Variables:
mode: sgml
sgml-parent-document: ("ecell3-users-manual.xml" "book" "chapter")
End:
-->

